#!/usr/bin/bash
# A wrapper script to decompress various archive types.

# options: help and list
if (( ! $# )) \
|| [[ "$*" =~ (^| )-h( |$) ]] || [[ "$*" =~ (^| )--help( |$) ]] \
|| [[ "$*" =  -l           ]] || [[ "$*" =  --list           ]] ; then
  printf "${0##*/} [*-l] <file>... â€” wrapper script to decompress various "
  echo   "archive types"
  echo   "  -l, --list  - list archive contents"
  exit 2
elif [[ "$*" =~ (^| )-l( |$) ]] || [[ "$*" =~ (^| )--list( |$) ]] ; then
  list=y
fi 

# archive existence test
for archive in "$@" ; do
  [ "$archive" = -l -o "$archive" = --list ] && continue
  [ ! -f "$archive" ] && { echo archive non-existent: "$archive" ;arc_noex=yes;}
done ; [ "$arc_noex" ] && exit 1

# program existence test
shopt -s extglob
prg_test () { hash $prg 2>&- || { echo program required: $prg ; arc_prrq=y ; };}

for archive in "$@" ; do
case "$archive" in
  -l | --list              )  continue                   ;;
  *.tar                    )  prg=tar        ; prg_test  ;;
  *.@(tar.bz2|tb@(2|z|z2)) )  prg=bzip2      ; prg_test  ;;
  *.@(tar.gz|tgz)          )  prg=gzip       ; prg_test  ;;
  *.tar.lz                 )  prg=lzip       ; prg_test  ;;
  *.@(tar.lzma|tlz)        )  prg=xz         ; prg_test  ;;
  *.@(tar.xz|txz)          )  prg=xz         ; prg_test  ;;
  *.@(tar.Z|t?(a)z)        )  prg=gzip       ; prg_test  ;;
  *.7z                     )  prg=7zr        ; prg_test  ;;
  *.bz2                    )  prg=bunzip2    ; prg_test  ;;
  *.exe                    )  prg=cabextract ; prg_test  ;;
  *.gz                     )  prg=gunzip     ; prg_test  ;;
  *.lz                     )  prg=lzip       ; prg_test  ;;
  *.rar                    )  prg=unrar      ; prg_test  ;;
  *.xz                     )  prg=xz         ; prg_test  ;;
  *.Z                      )  prg=gzip       ; prg_test  ;;
  *.zip                    )  prg=unzip      ; prg_test  ;;
  *                        )  echo extension unknown: "$archive" ; arc_prrq=y ;;
esac
done ; [ "$arc_prrq" ] && exit 1

# list
[ "$list" ] && \
for archive in "$@" ; do
echo -e "\e[1m "$archive" \e[0m"
case "$archive" in
  -l | --list              )  continue                          ;;
  *.tar                    )  tar tvf           "$archive"      ;;  
  *.@(tar.bz2|tb@(2|z|z2)) )  tar tvf           "$archive"      ;;  
  *.@(tar.gz|tgz)          )  tar tvf           "$archive"      ;;  
  *.tar.lz                 )  tar tvf           "$archive"      ;;  
  *.@(tar.lzma|tlz)        )  tar tvf           "$archive"      ;;  
  *.@(tar.xz|txz)          )  tar tvf           "$archive"      ;;  
  *.@(tar.Z|t?(a)z)        )  tar tvf           "$archive"      ;;  
  *.7z                     )  7zr l             "$archive"      ;;  
  *.bz2                    )  echo              "${archive%.*}" ;;  
  *.exe                    )  cabextract --list "$archive"      ;;  
  *.gz                     )  echo              "${archive%.*}" ;;  
  *.lz                     )  echo              "${archive%.*}" ;;  
  *.rar                    )  unrar l           "$archive"      ;;  
  *.xz                     )  echo              "${archive%.*}" ;;    
  *.Z                      )  gzip --list       "$archive"      ;;  
  *.zip                    )  unzip -l          "$archive"      ;;  
esac
done ; [ "$list" ] && exit

# decompress
prn      () { printf "$archive"..." " ; }
run_test () { [ $? = 0 ] && echo success || echo ; }

for archive in "$@" ; do
case "$archive" in
  *.tar                    )  prn ; tar xf            "$archive" ; run_test ;;
  *.@(tar.bz2|tb@(2|z|z2)) )  prn ; tar xf            "$archive" ; run_test ;;
  *.@(tar.gz|tgz)          )  prn ; tar xf            "$archive" ; run_test ;;
  *.tar.lz                 )  prn ; tar xf            "$archive" ; run_test ;;
  *.@(tar.lzma|tlz)        )  prn ; tar xf            "$archive" ; run_test ;;
  *.@(tar.xz|txz)          )  prn ; tar xf            "$archive" ; run_test ;;
  *.@(tar.Z|t?(a)z)        )  prn ; tar xf            "$archive" ; run_test ;;
  *.7z                     )  prn ; 7zr x    -bd      "$archive" 2>&1 /dev/null
                              run_test ;;
  *.bz2                    )  prn ; bunzip2 --keep    "$archive" ; run_test ;;
  *.exe                    )  prn ; cabextract        "$archive" ; run_test ;;
  *.gz                     )  prn ; gunzip  --keep    "$archive" ; run_test ;;
  *.lz                     )  prn ; lzip    --keep -d "$archive" ; run_test ;;
  *.rar                    )  prn ; unrar     x       "$archive" ; run_test ;;
  *.xz                     )  prn ; unxz    --keep    "$archive" ; run_test ;;
  *.Z                      )  prn ; gunzip  --keep    "$archive" ; run_test ;;
  *.zip                    )  prn ; unzip    -q       "$archive" ; run_test ;;
esac
done
